{% extends "base.html.j2" %}
{% import "dialogs.html.j2" as dialogs %}
{% block body %}
    <h2>
        Group manager for realm <a href="{{ url_for('operator_group_manager_admin_bp.group_manager_index', realm=realm) }}">{{ realm }}</a>
    </h2>
    <h4 class="mt-3">
        <i class="bi bi-people" title="Group"></i> {{ group }}
        {% if protected_group %}<i class="bi bi-lock" title="Read only"></i>{% endif %}
    </h4>
    <div class="row">
        <div class="col-6">
            <h4>Current members</h4>
            {% if members %}
                <div class="list-group">
                    {% for member in members %}
                        <div class="list-group-item">
                            {% if editable %}
                                <span class="text-end">
                                    <input class="form-check-input"
                                           form="remove-members-form"
                                           type="checkbox"
                                           value="{{ member.name }}"
                                           name="members-to-remove" />
                                </span>
                            {% endif %}
                            {{ member.name }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            {% if editable %}
                <form method="post"
                      id="remove-members-form"
                      action="{{ url_for('operator_group_manager_admin_bp.remove_members', realm=realm, group=group) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit"
                            class="btn btn-secondary mt-3"
                            id="remove-members"
                            disabled>Remove selected users</button>
                </form>
            {% endif %}
        </div>
        <div class="col-6">
            <h4>Other members of {{ realm }}</h4>
            {% if non_members %}
                <div class="list-group">
                    {% for member in non_members %}
                        <div class="list-group-item">
                            <span class="text-end">
                                {% if editable %}
                                    <input class="form-check-input"
                                           form="add-members-form"
                                           type="checkbox"
                                           value="{{ member.name }}"
                                           name="members-to-add" />
                                {% endif %}
                                {{ member.name }}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            {% if editable %}
                <form method="post"
                      id="add-members-form"
                      action="{{ url_for('operator_group_manager_admin_bp.add_members', realm=realm, group=group) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" class="btn btn-primary mt-3" id="add-members" disabled>Add selected users</button>
                {% endif %}
            </form>
        </div>
    </div>
    {% if editable %}
        <div class="text-end">
            {{ dialogs.confirm_delete_dialog('delete_group_'~group, url_for("operator_group_manager_admin_bp.remove_group",  realm=realm) , title = 'Delete this group', button_title='Delete', readonly_fields=[{'name': 'group_name', 'label': 'Group name', 'value': group}]) }}
        </div>
    {% endif %}
    <script>
    remove_checkboxes = document.getElementsByName("members-to-remove");
    add_checkboxes = document.getElementsByName("members-to-add");
    remove_btn = document.getElementById("remove-members")
    add_btn = document.getElementById("add-members")

    for (var i = 0; i < remove_checkboxes.length; i++) {
        remove_checkboxes[i].addEventListener("click", () => set_button_state(remove_btn, remove_checkboxes));
    }

    for (var i = 0; i < add_checkboxes.length; i++) {
        add_checkboxes[i].addEventListener("click", () => set_button_state(add_btn, add_checkboxes));
    }

    function set_button_state(target_button, check_boxes) {
        is_one_or_more_checked = false;
        for (var i = 0; i < check_boxes.length; i++) {
            if (check_boxes[i].checked) {
                is_one_or_more_checked = true
            }
        }
        target_button.disabled = !is_one_or_more_checked

    }

    </script>
{% endblock body %}
